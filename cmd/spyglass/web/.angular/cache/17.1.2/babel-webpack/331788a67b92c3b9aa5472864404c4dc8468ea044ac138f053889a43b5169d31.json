{"ast":null,"code":"import { Validators } from \"@angular/forms\";\nimport { of } from \"rxjs\";\nimport { tap, startWith, debounceTime, distinctUntilChanged, switchMap, map, catchError } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/toolbar\";\nimport * as i5 from \"@angular/material/icon\";\nimport * as i6 from \"@angular/material/autocomplete\";\nimport * as i7 from \"@angular/material/core\";\nimport * as i8 from \"@angular/material/input\";\nimport * as i9 from \"@angular/material/form-field\";\nimport * as i10 from \"@angular/material/stepper\";\nimport * as i11 from \"@angular/material/button\";\nimport * as i12 from \"@angular/material/list\";\nfunction AppComponent_ng_template_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Pick a room\");\n  }\n}\nfunction AppComponent_mat_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const opt_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", opt_r7);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", opt_r7, \" \");\n  }\n}\nfunction AppComponent_mat_error_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Invalid room\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_ng_template_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Pick a control group\");\n  }\n}\nfunction AppComponent_button_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function AppComponent_button_27_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const opt_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.selectControlGroup(opt_r8));\n    });\n    i0.ɵɵelementStart(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"span\", 19);\n    i0.ɵɵelementStart(4, \"mat-icon\");\n    i0.ɵɵtext(5, \"chevron_right\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const opt_r8 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(opt_r8);\n  }\n}\nexport let APIService = /*#__PURE__*/(() => {\n  class APIService {\n    constructor(http) {\n      this.http = http;\n      this.rooms = [];\n    }\n    getRooms() {\n      return this.rooms.length ? of(this.rooms) : this.http.get(\"/api/v1/rooms\").pipe(tap(data => {\n        this.rooms = data;\n      }));\n    }\n    getControlGroups(room) {\n      return this.http.get(\"/api/v1/rooms/\" + encodeURIComponent(room) + \"/controlGroups\");\n    }\n    roomValidator() {\n      return ctrl => {\n        return this.getRooms().pipe(map(rooms => {\n          return rooms.includes(ctrl.value) ? null : {\n            invalidRoom: true\n          };\n        }), catchError(() => of({\n          invalidRoom: true\n        })));\n      };\n    }\n    static {\n      this.ɵfac = function APIService_Factory(t) {\n        return new (t || APIService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: APIService,\n        factory: APIService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return APIService;\n})();\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(_api, _formBuilder) {\n      this._api = _api;\n      this._formBuilder = _formBuilder;\n      this.firstFormGroup = this._formBuilder.group({\n        room: ['', [Validators.required], [this._api.roomValidator()]]\n      });\n      this.secondFormGroup = this._formBuilder.group({\n        controlGroup: ['']\n      });\n    }\n    ngOnInit() {\n      this.filteredRooms = this.firstFormGroup.controls['room'].valueChanges.pipe(startWith(''), debounceTime(250), distinctUntilChanged(), switchMap(val => {\n        return this.filter(val || '');\n      }));\n    }\n    filter(val) {\n      return this._api.getRooms().pipe(map(resp => resp.filter(opt => {\n        return opt.toLowerCase().indexOf(val.toLowerCase()) === 0;\n      })));\n    }\n    formStep(event) {\n      switch (event.selectedIndex) {\n        case 0:\n          this.controlGroups = [];\n        case 1:\n          const room = this.firstFormGroup.controls['room'].value;\n          this._api.getControlGroups(room).subscribe(data => {\n            this.controlGroups = data;\n          });\n      }\n    }\n    selectControlGroup(cg) {\n      let room = this.firstFormGroup.controls['room'].value;\n      room = encodeURIComponent(room);\n      cg = encodeURIComponent(cg);\n      window.location.assign('/api/v1/rooms/' + room + '/controlGroups/' + cg);\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(t) {\n        return new (t || AppComponent)(i0.ɵɵdirectiveInject(APIService), i0.ɵɵdirectiveInject(i2.UntypedFormBuilder));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        decls: 33,\n        vars: 10,\n        consts: [[2, \"margin-left\", \".5vw\"], [1, \"body\"], [\"linear\", \"\", 1, \"stepper\", 3, \"selectionChange\"], [\"stepper\", \"\"], [3, \"stepControl\"], [3, \"formGroup\"], [\"matStepLabel\", \"\"], [\"appearance\", \"outline\", 1, \"full-width\"], [\"type\", \"text\", \"matInput\", \"\", \"formControlName\", \"room\", 3, \"matAutocomplete\"], [\"auto\", \"matAutocomplete\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [\"mat-button\", \"\", \"matStepperNext\", \"\"], [1, \"controlGroups\"], [\"mat-list-item\", \"\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"mat-button\", \"\", \"matStepperPrevious\", \"\"], [\"mat-button\", \"\", 3, \"click\"], [3, \"value\"], [\"mat-list-item\", \"\", 3, \"click\"], [1, \"spacer\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r11 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"mat-toolbar\")(1, \"mat-icon\");\n            i0.ɵɵtext(2, \"camera\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"span\", 0);\n            i0.ɵɵtext(4, \"Spyglass\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(5, \"div\", 1)(6, \"mat-vertical-stepper\", 2, 3);\n            i0.ɵɵlistener(\"selectionChange\", function AppComponent_Template_mat_vertical_stepper_selectionChange_6_listener($event) {\n              return ctx.formStep($event);\n            });\n            i0.ɵɵelementStart(8, \"mat-step\", 4)(9, \"form\", 5);\n            i0.ɵɵtemplate(10, AppComponent_ng_template_10_Template, 1, 0, \"ng-template\", 6);\n            i0.ɵɵelementStart(11, \"mat-form-field\", 7)(12, \"mat-label\");\n            i0.ɵɵtext(13, \"Room\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(14, \"input\", 8);\n            i0.ɵɵelementStart(15, \"mat-autocomplete\", null, 9);\n            i0.ɵɵtemplate(17, AppComponent_mat_option_17_Template, 2, 2, \"mat-option\", 10);\n            i0.ɵɵpipe(18, \"async\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(19, AppComponent_mat_error_19_Template, 2, 0, \"mat-error\", 11);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"div\")(21, \"button\", 12);\n            i0.ɵɵtext(22, \"Next\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(23, \"mat-step\", 4)(24, \"form\", 5);\n            i0.ɵɵtemplate(25, AppComponent_ng_template_25_Template, 1, 0, \"ng-template\", 6);\n            i0.ɵɵelementStart(26, \"mat-action-list\", 13);\n            i0.ɵɵtemplate(27, AppComponent_button_27_Template, 6, 1, \"button\", 14);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"div\")(29, \"button\", 15);\n            i0.ɵɵtext(30, \"Back\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(31, \"button\", 16);\n            i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_31_listener() {\n              i0.ɵɵrestoreView(_r11);\n              const _r0 = i0.ɵɵreference(7);\n              return i0.ɵɵresetView(_r0.reset());\n            });\n            i0.ɵɵtext(32, \"Reset\");\n            i0.ɵɵelementEnd()()()()()();\n          }\n          if (rf & 2) {\n            const _r2 = i0.ɵɵreference(16);\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"stepControl\", ctx.firstFormGroup);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"formGroup\", ctx.firstFormGroup);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"matAutocomplete\", _r2);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(18, 8, ctx.filteredRooms));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.firstFormGroup.controls.room.errors == null ? null : ctx.firstFormGroup.controls.room.errors.invalidRoom);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"stepControl\", ctx.secondFormGroup);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"formGroup\", ctx.secondFormGroup);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.controlGroups);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, i4.MatToolbar, i5.MatIcon, i6.MatAutocomplete, i7.MatOption, i6.MatAutocompleteTrigger, i8.MatInput, i9.MatFormField, i9.MatLabel, i9.MatError, i10.MatStep, i10.MatStepLabel, i10.MatStepper, i10.MatStepperNext, i10.MatStepperPrevious, i11.MatButton, i12.MatActionList, i12.MatListItem, i3.AsyncPipe],\n        styles: [\".body[_ngcontent-%COMP%]{width:100%;height:50%;display:flex;flex-direction:column;justify-content:center;align-items:center}.stepper[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.full-width[_ngcontent-%COMP%]{width:100%}.controlGroups[_ngcontent-%COMP%]{padding-bottom:1vh;width:66%}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}\"]\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}